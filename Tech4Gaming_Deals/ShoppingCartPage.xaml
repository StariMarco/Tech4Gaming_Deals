<?xml version="1.0" encoding="UTF-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Tech4Gaming_Deals.ShoppingCartPage"
             xmlns:d="http://xamarin.com/schemas/2014/forms/design"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             xmlns:local1="clr-namespace:Tech4Gaming_Deals.CustomControls"
             Title="Shopping Cart">

    <ContentPage.BackgroundColor>
            <OnPlatform x:TypeArguments="Color">
                <On Platform="Android" Value="{x:StaticResource Key=colorPrimary}"/>
                <On Platform="iOS" Value="White"/>
            </OnPlatform>
    </ContentPage.BackgroundColor>

    <AbsoluteLayout>
        <StackLayout AbsoluteLayout.LayoutBounds="0, 0, 1, 1"
                     AbsoluteLayout.LayoutFlags="All">
            
            <Label Text="No Internet connection"
                   HorizontalOptions="Center"
                   Margin="0, 5"
                   IsVisible="false"
                   x:Name="lblOffline">
                <Label.TextColor>
                    <OnPlatform x:TypeArguments="Color">
                        <On Platform="Android" Value="White"/>
                        <On Platform="iOS" Value="{x:StaticResource Key=colorSecondaryText}"/>
                    </OnPlatform>
                </Label.TextColor>
            </Label>

            <!--#region-->
            <StackLayout Margin="0, 5, 0, 0">
                <ListView x:Name="lstCartProducts"
                          HasUnevenRows="True"
                          HorizontalOptions="Center"
                          SeparatorVisibility="None"
                          ItemSelected="DisableSelection"
                          VerticalScrollBarVisibility="Never"
                          CachingStrategy="RecycleElementAndDataTemplate"
                          IsPullToRefreshEnabled="True"
                          Refreshing="OnRefreshProducts"
                          ItemTapped="OnShowPopup"
                          BindingContext="{Binding .}">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <ViewCell BindingContextChanged="OnBindingContexChanged">
                                <StackLayout Padding="10, 6, 10, 6">
                                    <local1:MaterialFrame BackgroundColor="White"
                                           Padding="0"
                                           VerticalOptions="Start"
                                           CornerRadius="10">
                                        <StackLayout Orientation="Horizontal" Padding="6, 5, 5, 5">
                                            <Frame IsClippedToBounds="True"
                                                   Padding="0"
                                                   Margin="0"
                                                   CornerRadius="10"
                                                   HasShadow="False">
                                                <Image BackgroundColor="Transparent"
                                                       x:Name="imgProduct"
                                                       Source="{Binding productImage}"
                                                       HorizontalOptions="Start"
                                                       Style="{DynamicResource Key=imageProduct}"
                                                       WidthRequest="{Binding Source={x:Reference imgProduct}, Path=HeightRequest}"/>
                                            </Frame>
                                            <AbsoluteLayout HorizontalOptions="FillAndExpand">
                                                <StackLayout Padding="0, 5, 0, 5"
                                                             AbsoluteLayout.LayoutBounds="0, 0, 1, 1"
                                                             AbsoluteLayout.LayoutFlags="All"
                                                             HorizontalOptions="FillAndExpand">
                                                    <Label Text="{Binding Name}"
                                                           Style="{DynamicResource Key=fntszNormal}"
                                                           TextColor="{x:StaticResource colorPrimaryText}"
                                                           MaxLines="3"
                                                           LineBreakMode="TailTruncation"/>
                                                    <StackLayout Orientation="Horizontal"
                                                                 Spacing="5"
                                                                 HorizontalOptions="FillAndExpand"
                                                                 VerticalOptions="FillAndExpand">
                                                        <Label Text="{Binding SalePrice, StringFormat='{0:F2}€'}"
                                                               x:Name="lblProductSalePrice"
                                                               Style="{DynamicResource Key=fntszNormal}"
                                                               TextColor="{x:StaticResource colorRed}"/>
                                                        <Label Text="{Binding Price, StringFormat='{0:F2}€'}"
                                                               x:Name="lblProductPrice"
                                                               Style="{DynamicResource Key=fntszSmall}"
                                                               TextDecorations="Strikethrough"
                                                               TextColor="{x:StaticResource colorPrimaryText}"/>
                                                        <Label Text="{Binding Date}"
                                                               Style="{DynamicResource Key=fntszSmall}"
                                                               TextColor="{x:StaticResource Key=colorSecondaryText}"
                                                               VerticalOptions="End"
                                                               HorizontalOptions="EndAndExpand"
                                                               Margin="20, 0, 0, 0"/>
                                                    </StackLayout>
                                                </StackLayout>
                                            </AbsoluteLayout>
                                        </StackLayout>
                                    </local1:MaterialFrame>
                                </StackLayout>
                            </ViewCell>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </StackLayout>
            <!--#endregion-->
        </StackLayout>
    </AbsoluteLayout>

</ContentPage>
